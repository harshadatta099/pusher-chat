<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pusher Test</title>
    <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
    <script>
        Pusher.logToConsole = true;

        var pusher = new Pusher('04110b925bdfe2cdce22', {
            cluster: 'ap2',
            authEndpoint: 'http://localhost:3000/pusher/auth'
        });

        function sendMessage() {
            var messageInput = document.getElementById('message-input');
            var message = messageInput.value;
            var channelName = 'private-channel';

            fetch('http://localhost:3000/send-message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message, channelName: channelName })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to send message');
                    }
                    messageInput.value = '';
                })
                .catch(error => console.error('Error sending message:', error));
        }

        function subscribeToChannel(channelName) {
            debugger;
            var channel = pusher.subscribe(channelName);
            channel.bind('my-event', function (data) {
                console.log("data", data);
                var messageContainer = document.getElementById('message-container');
                var messageElement = document.createElement('div');
                messageElement.textContent = data.message;
                messageContainer.appendChild(messageElement);
            });
        }

        window.onload = function () {
            var channelName = 'private-channel';
            subscribeToChannel(channelName);
        };
    </script>
</head>

<body>
    <h1>Pusher Test</h1>
    <div id="message-container"></div>
    <input type="text" id="message-input" placeholder="Enter your message">
    <button onclick="sendMessage()">Send</button>
</body>

</html>